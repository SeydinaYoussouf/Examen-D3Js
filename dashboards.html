<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gaming Analytics Dashboard Pro</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: #0a0e27;
      color: #fff;
      overflow-x: hidden;
    }

    .bg-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0a0e27 100%);
      z-index: -1;
    }

    .bg-animation::before {
      content: '';
      position: absolute;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(0, 210, 255, 0.1) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: moveBackground 20s linear infinite;
    }

    @keyframes moveBackground {
      0% {
        transform: translate(0, 0);
      }

      100% {
        transform: translate(50px, 50px);
      }
    }

    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 80px;
      background: rgba(10, 14, 39, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 2px solid rgba(0, 210, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 50px;
      z-index: 1000;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #00d2ff 0%, #3a47d5 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      box-shadow: 0 4px 15px rgba(0, 210, 255, 0.4);
    }

    .logo-text h1 {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(135deg, #00d2ff 0%, #3a47d5 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logo-text p {
      font-size: 11px;
      color: #7a8ba3;
      font-weight: 400;
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    .nav-links {
      display: flex;
      gap: 10px;
    }

    .nav-link {
      padding: 12px 24px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      font-weight: 500;
      color: #7a8ba3;
      text-decoration: none;
      position: relative;
      overflow: hidden;
    }

    .nav-link::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #00d2ff 0%, #3a47d5 100%);
      transition: left 0.3s ease;
      z-index: -1;
    }

    .nav-link:hover::before,
    .nav-link.active::before {
      left: 0;
    }

    .nav-link:hover,
    .nav-link.active {
      color: white;
    }

    .nav-link.active {
      box-shadow: 0 4px 20px rgba(0, 210, 255, 0.3);
    }

    .main-content {
      margin-top: 100px;
      padding: 40px 50px 80px 50px;
    }

    .hero {
      text-align: center;
      margin-bottom: 60px;
      animation: fadeInDown 1s ease;
    }

    .hero h1 {
      font-size: 56px;
      font-weight: 800;
      margin-bottom: 15px;
      background: linear-gradient(135deg, #00d2ff 0%, #3a47d5 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -1px;
    }

    .hero p {
      font-size: 18px;
      color: #7a8ba3;
      font-weight: 300;
    }

    .stats-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 25px;
      margin-bottom: 60px;
      animation: fadeInUp 1s ease 0.2s backwards;
    }

    .stat-box {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
    }

    .stat-box::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(0, 210, 255, 0.1) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .stat-box:hover::before {
      opacity: 1;
    }

    .stat-box:hover {
      transform: translateY(-10px);
      border-color: rgba(0, 210, 255, 0.5);
      box-shadow: 0 20px 40px rgba(0, 210, 255, 0.2);
    }

    .stat-icon {
      font-size: 48px;
      margin-bottom: 15px;
      filter: drop-shadow(0 0 20px rgba(0, 210, 255, 0.5));
    }

    .stat-value {
      font-size: 42px;
      font-weight: 800;
      background: linear-gradient(135deg, #00d2ff 0%, #3a47d5 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
    }

    .stat-label {
      font-size: 13px;
      color: #7a8ba3;
      text-transform: uppercase;
      letter-spacing: 2px;
      font-weight: 500;
    }

    .section {
      margin-bottom: 60px;
      opacity: 0;
      animation: fadeInUp 1s ease forwards;
    }

    .section:nth-child(1) {
      animation-delay: 0.3s;
    }

    .section:nth-child(2) {
      animation-delay: 0.4s;
    }

    .section:nth-child(3) {
      animation-delay: 0.5s;
    }

    .section:nth-child(4) {
      animation-delay: 0.6s;
    }

    .chart-card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 25px;
      padding: 40px;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
    }

    .chart-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #00d2ff 0%, #3a47d5 100%);
    }

    .chart-card:hover {
      transform: translateY(-8px);
      border-color: rgba(0, 210, 255, 0.3);
      box-shadow: 0 25px 50px rgba(0, 210, 255, 0.15);
    }

    .chart-header {
      margin-bottom: 30px;
    }

    .chart-title {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
      background: linear-gradient(135deg, #00d2ff 0%, #3a47d5 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .chart-subtitle {
      font-size: 14px;
      color: #7a8ba3;
      font-weight: 400;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 30px;
      margin-bottom: 60px;
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-40px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .footer {
      text-align: center;
      padding: 40px;
      color: #7a8ba3;
      font-size: 13px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 60px;
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 20px;
    }

    .footer-links a {
      color: #7a8ba3;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .footer-links a:hover {
      color: #00d2ff;
    }

    .svg-container {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    svg {
      display: block;
    }

    .axis text {
      fill: #fff;
      font-size: 11px;
    }

    .axis line,
    .axis path {
      stroke: rgba(255, 255, 255, 0.2);
    }

    /* TOOLTIP GLOBAL */
    .tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.95);
      color: #fff;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 13px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
      border: 2px solid #00d2ff;
      box-shadow: 0 4px 20px rgba(0, 210, 255, 0.4);
      z-index: 10000;
    }

    @media (max-width: 1200px) {

      .stats-container,
      .grid-2 {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .navbar {
        padding: 0 20px;
      }

      .nav-links {
        display: none;
      }

      .main-content {
        padding: 20px;
      }

      .stats-container,
      .grid-2 {
        grid-template-columns: 1fr;
      }

      .hero h1 {
        font-size: 36px;
      }
    }

    .scroll-indicator {
      position: fixed;
      top: 80px;
      left: 0;
      width: 0%;
      height: 3px;
      background: linear-gradient(90deg, #00d2ff 0%, #3a47d5 100%);
      z-index: 999;
      transition: width 0.3s ease;
    }
  </style>
</head>

<body>
  <!-- root  -->
  <div class="bg-animation"></div>
  <div class="scroll-indicator" id="scrollIndicator"></div>

  <nav class="navbar">
    <div class="logo">
      <div class="logo-icon">üéÆ</div>
      <div class="logo-text">
        <h1>Gaming Analytics</h1>
        <p>Pro Dashboard</p>
      </div>
    </div>
    <div class="nav-links">
      <a href="#overview" class="nav-link active">Overview</a>
      <a href="#treemap" class="nav-link">Treemap</a>
      <a href="#analytics" class="nav-link">Analytics</a>
      <a href="#sunburst" class="nav-link">Sunburst</a>
    </div>
  </nav>

  <div class="main-content">

    <div class="hero" id="overview">
      <h1>Gaming Data Insights</h1>
      <p>Pr√©sentation de mon Projet D3 - Par Youssoupha NDIAYE</p>
    </div>

    <div class="stats-container">
      <div class="stat-box">
        <div class="stat-icon">üéØ</div>
        <div class="stat-value" id="total-platforms">0</div>
        <div class="stat-label">Plateformes</div>
      </div>
      <div class="stat-box">
        <div class="stat-icon">üéÆ</div>
        <div class="stat-value" id="total-games">0</div>
        <div class="stat-label">Total Jeux</div>
      </div>
      <div class="stat-box">
        <div class="stat-icon">üí∞</div>
        <div class="stat-value" id="total-sales">0M</div>
        <div class="stat-label">Ventes Globales</div>
      </div>
      <div class="stat-box">
        <div class="stat-icon">üèÜ</div>
        <div class="stat-value" id="top-platform">-</div>
        <div class="stat-label">Leader</div>
      </div>
    </div>

    <div class="section" id="treemap">
      <div class="chart-card">
        <div class="chart-header">
          <h2 class="chart-title">üó∫Ô∏è Vue Hi√©rarchique</h2>
          <p class="chart-subtitle">Cartographie proportionnelle des ventes par plateforme</p>
        </div>
        <div class="svg-container">
          <svg id="treemap-svg" width="1400" height="700"></svg>
        </div>
      </div>
    </div>

    <div class="grid-2" id="analytics">
      <div class="chart-card">
        <div class="chart-header">
          <h2 class="chart-title">üìä Performance</h2>
          <p class="chart-subtitle">Comparaison des plateformes</p>
        </div>
        <div class="svg-container">
          <svg id="barchart-svg" width="650" height="500"></svg>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-header">
          <h2 class="chart-title">ü•ß Distribution</h2>
          <p class="chart-subtitle">Parts de march√©</p>
        </div>
        <div class="svg-container">
          <svg id="piechart-svg" width="650" height="500"></svg>
        </div>
      </div>
    </div>

    <div class="section" id="sunburst">
      <div class="chart-card">
        <div class="chart-header">
          <h2 class="chart-title">‚òÄÔ∏è Visualisation Radiale</h2>
          <p class="chart-subtitle">Structure hi√©rarchique interactive</p>
        </div>
        <div class="svg-container">
          <svg id="sunburst-svg" width="1400" height="750"></svg>
        </div>
      </div>
    </div>

    <div class="footer">
      <div class="footer-links">
        <a href="#">Documentation</a>
        <a href="#">API</a>
        <a href="#">Contact</a>
        <a href="#">GitHub</a>
      </div>
      <p>¬© 2024 Gaming Analytics Pro - Projet D3 r√©alis√© par Youssoupha NDIAYE</p>
      <p style="margin-top: 10px; font-size: 11px;">Powered by D3.js & Modern Web Technologies</p>
    </div>

  </div>

  <script>
    // ==================== SCROLL INDICATOR ==================== 
    window.addEventListener('scroll', () => {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrollPercent = (scrollTop / scrollHeight) * 100;
      document.getElementById('scrollIndicator').style.width = scrollPercent + '%';
    });

    // ==================== NAVIGATION ACTIVE STATE ==================== 
    const navLinks = document.querySelectorAll('.nav-link');
    const sections = document.querySelectorAll('.section, .hero, .stats-container');

    window.addEventListener('scroll', () => {
      let current = '';

      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        if (pageYOffset >= sectionTop - 200) {
          current = section.getAttribute('id');
        }
      });

      navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href').substring(1) === current) {
          link.classList.add('active');
        }
      });
    });

    // ==================== SMOOTH SCROLL ==================== 
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          window.scrollTo({
            top: target.offsetTop - 100,
            behavior: 'smooth'
          });
        }
      });
    });

    // ==================== STATS COUNTER ANIMATION ==================== 
    function animateValue(id, start, end, duration, suffix = '') {
      const obj = document.getElementById(id);
      if (!obj) return;

      const range = end - start;
      const increment = range / (duration / 16);
      let current = start;

      const timer = setInterval(() => {
        current += increment;
        if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
          current = end;
          clearInterval(timer);
        }
        obj.textContent = Math.round(current) + suffix;
      }, 16);
    }

    // ==================== CR√âATION TOOLTIP GLOBALE ==================== 
    const tooltip = d3.select("body")
      .append("div")
      .attr("class", "tooltip");

    // ==================== LOAD DATA ==================== 
    const url = "https://cdn.freecodecamp.org/testable-projects-fcc/data/tree_map/video-game-sales-data.json";

    d3.json(url).then(data => {
      console.log("‚úÖ Donn√©es charg√©es:", data);

      // Calculer les stats
      const totalPlatforms = data.children.length;
      const totalGames = d3.sum(data.children, p => p.children.length);
      const totalSales = d3.sum(data.children, p => d3.sum(p.children, g => g.value));
      const topPlatform = data.children
        .map(p => ({ name: p.name, sales: d3.sum(p.children, g => g.value) }))
        .sort((a, b) => b.sales - a.sales)[0].name;

      console.log("üìä Stats:", { totalPlatforms, totalGames, totalSales, topPlatform });

      // Animer les stats
      setTimeout(() => {
        animateValue('total-platforms', 0, totalPlatforms, 1500);
        animateValue('total-games', 0, totalGames, 2000);
        animateValue('total-sales', 0, Math.round(totalSales), 2500, 'M');
        setTimeout(() => {
          document.getElementById('top-platform').textContent = topPlatform;
        }, 1000);
      }, 500);

      // Dessiner les graphiques
      drawTreemap(data);
      drawBarChart(data);
      drawPieChart(data);
      drawSunburst(data);
    }).catch(error => {
      console.error("‚ùå Erreur chargement:", error);
    });

    // ==================== TREEMAP ====================
    function drawTreemap(data) {
      console.log("üé® Dessin Treemap...");
      const svg = d3.select("#treemap-svg");
      const width = +svg.attr("width");
      const height = +svg.attr("height");
      svg.selectAll("*").remove();

      const margin = { top: 10, right: 10, bottom: 120, left: 10 };
      const innerWidth = width - margin.left - margin.right;
      const innerHeight = height - margin.top - margin.bottom;

      const g = svg.append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

      const color = d3.scaleOrdinal(d3.schemeTableau10);

      const treemap = d3.treemap()
        .size([innerWidth, innerHeight])
        .paddingInner(3)
        .paddingOuter(3)
        .round(true);

      const root = d3.hierarchy(data)
        .sum(d => d.value ? +d.value : 0)
        .sort((a, b) => b.value - a.value);

      treemap(root);

      const leaves = root.leaves();
      console.log("üì¶ Nombre de rectangles:", leaves.length);

      // Cr√©er un tooltip S√âPAR√â pour le treemap uniquement
      const treemapTooltip = d3.select("body")
        .append("div")
        .attr("class", "tooltip")
        .attr("id", "treemap-tooltip")
        .style("position", "absolute")
        .style("background", "rgba(0, 0, 0, 0.95)")
        .style("color", "#fff")
        .style("padding", "12px 16px")
        .style("border-radius", "8px")
        .style("font-size", "13px")
        .style("pointer-events", "none")
        .style("opacity", 0)
        .style("border", "2px solid #00d2ff")
        .style("box-shadow", "0 4px 20px rgba(0, 210, 255, 0.4)")
        .style("z-index", "10000");

      const cell = g.selectAll("g")
        .data(leaves)
        .enter()
        .append("g")
        .attr("transform", d => `translate(${d.x0},${d.y0})`);

      // Rectangles
      cell.append("rect")
        .attr("class", "treemap-rect")
        .attr("width", d => d.x1 - d.x0)
        .attr("height", d => d.y1 - d.y0)
        .attr("fill", d => {
          let parent = d;
          while (parent.depth > 1) parent = parent.parent;
          return color(parent.data.name);
        })
        .attr("stroke", "#fff")
        .attr("stroke-width", 2)
        .attr("opacity", 0.85)
        .style("cursor", "pointer")
        .attr("data-game-name", d => d.data.name)
        .attr("data-platform-name", d => d.parent.data.name)
        .attr("data-game-value", d => d.data.value)
        .on("mouseover", function (event) {
          const rect = d3.select(this);
          rect.attr("opacity", 1)
            .attr("stroke", "#00d2ff")
            .attr("stroke-width", 3);

          const gameName = rect.attr("data-game-name");
          const platformName = rect.attr("data-platform-name");
          const gameValue = parseFloat(rect.attr("data-game-value"));

          treemapTooltip
            .style("opacity", 1)
            .html(`
              <div style="font-weight: bold; color: #00d2ff; margin-bottom: 5px; font-size: 14px;">
                ${gameName}
              </div>
              <div style="color: #7a8ba3; margin-bottom: 3px; font-size: 12px;">
                Plateforme: ${platformName}
              </div>
              <div style="font-weight: 600;">
                Ventes: ${gameValue.toFixed(2)}M
              </div>
            `);
        })
        .on("mousemove", function (event) {
          treemapTooltip
            .style("left", (event.pageX + 15) + "px")
            .style("top", (event.pageY - 30) + "px");
        })
        .on("mouseout", function () {
          d3.select(this)
            .attr("opacity", 0.85)
            .attr("stroke", "#fff")
            .attr("stroke-width", 2);

          treemapTooltip.style("opacity", 0);
        });

      // Texte
      cell.append("text")
        .attr("x", 4)
        .attr("y", 14)
        .attr("font-size", "10px")
        .attr("fill", "#fff")
        .attr("font-weight", "600")
        .style("text-shadow", "1px 1px 2px rgba(0,0,0,0.8)")
        .style("pointer-events", "none")
        .text(d => {
          const w = d.x1 - d.x0;
          const h = d.y1 - d.y0;
          if (w < 40 || h < 20) return "";
          return d.data.name.length > 15 ? d.data.name.substring(0, 12) + "..." : d.data.name;
        });

      // L√©gende
      const categories = root.children.map(d => d.data.name);
      const legend = g.append("g")
        .attr("transform", `translate(0, ${innerHeight + 20})`);

      categories.forEach((cat, i) => {
        const item = legend.append("g")
          .attr("transform", `translate(${(i % 6) * 140}, ${Math.floor(i / 6) * 28})`);

        item.append("rect")
          .attr("width", 22)
          .attr("height", 22)
          .attr("rx", 4)
          .attr("fill", color(cat));

        item.append("text")
          .attr("x", 30)
          .attr("y", 16)
          .text(cat)
          .attr("font-size", "12px")
          .attr("fill", "#fff")
          .attr("font-weight", "500");
      });

      console.log("‚úÖ Treemap OK -", leaves.length, "rectangles");
    }

    // ==================== BAR CHART ====================
    function drawBarChart(data) {
      console.log("üìä Dessin Bar Chart...");
      const svg = d3.select("#barchart-svg");
      const width = +svg.attr("width");
      const height = +svg.attr("height");
      svg.selectAll("*").remove();

      const margin = { top: 40, right: 30, bottom: 120, left: 70 };
      const innerWidth = width - margin.left - margin.right;
      const innerHeight = height - margin.top - margin.bottom;

      const g = svg.append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

      const totalByPlatform = data.children.map(p => ({
        platform: p.name,
        totalVentes: d3.sum(p.children, d => d.value)
      })).sort((a, b) => b.totalVentes - a.totalVentes).slice(0, 10);

      console.log("üìä Donn√©es bar chart:", totalByPlatform);

      const x = d3.scaleBand()
        .domain(totalByPlatform.map(d => d.platform))
        .range([0, innerWidth])
        .padding(0.2);

      const y = d3.scaleLinear()
        .domain([0, d3.max(totalByPlatform, d => d.totalVentes)])
        .nice()
        .range([innerHeight, 0]);

      const colorScale = d3.scaleSequential()
        .domain([0, totalByPlatform.length - 1])
        .interpolator(d3.interpolateRgb("#3a47d5", "#00d2ff"));

      // Axes
      g.append("g")
        .attr("class", "axis")
        .attr("transform", `translate(0,${innerHeight})`)
        .call(d3.axisBottom(x))
        .selectAll("text")
        .attr("transform", "rotate(-45)")
        .attr("dx", "-0.8em")
        .attr("dy", "0.15em")
        .style("text-anchor", "end");

      g.append("g")
        .attr("class", "axis")
        .call(d3.axisLeft(y).tickFormat(d => d3.format(".2s")(d)));

      // Barres
      g.selectAll(".bar")
        .data(totalByPlatform)
        .enter()
        .append("rect")
        .attr("class", "bar")
        .attr("x", d => x(d.platform))
        .attr("y", d => y(d.totalVentes))
        .attr("width", x.bandwidth())
        .attr("height", d => innerHeight - y(d.totalVentes))
        .attr("fill", (d, i) => colorScale(i))
        .attr("rx", 4)
        .style("cursor", "pointer")
        .on("mouseover", function (event, d) {
          d3.select(this)
            .transition()
            .duration(200)
            .attr("y", y(d.totalVentes) - 5)
            .attr("height", innerHeight - y(d.totalVentes) + 5);

          tooltip
            .style("opacity", 1)
            .html(`
              <div style="font-weight: bold; color: #00d2ff; margin-bottom: 5px; font-size: 14px;">
                ${d.platform}
              </div>
              <div style="font-weight: 600;">
                Ventes: ${d.totalVentes.toFixed(2)}M
              </div>
            `);
        })
        .on("mousemove", function (event) {
          tooltip
            .style("left", (event.pageX + 15) + "px")
            .style("top", (event.pageY - 30) + "px");
        })
        .on("mouseout", function (event, d) {
          d3.select(this)
            .transition()
            .duration(200)
            .attr("y", y(d.totalVentes))
            .attr("height", innerHeight - y(d.totalVentes));

          tooltip.style("opacity", 0);
        });

      console.log("‚úÖ Bar Chart OK");
    }

    // ==================== PIE CHART ====================
    function drawPieChart(data) {
      console.log("ü•ß Dessin Pie Chart...");
      const svg = d3.select("#piechart-svg");
      const width = +svg.attr("width");
      const height = +svg.attr("height");
      svg.selectAll("*").remove();

      const totalByPlatform = data.children.map(p => ({
        platform: p.name,
        totalVentes: d3.sum(p.children, d => d.value)
      })).sort((a, b) => b.totalVentes - a.totalVentes);

      console.log("ü•ß Donn√©es pie chart:", totalByPlatform);

      const radius = Math.min(width, height) / 2 - 80;
      const g = svg.append("g")
        .attr("transform", `translate(${width / 2 - 100}, ${height / 2})`);

      const pie = d3.pie()
        .value(d => d.totalVentes)
        .sort(null);

      const arc = d3.arc()
        .innerRadius(radius * 0.5)
        .outerRadius(radius);

      const arcHover = d3.arc()
        .innerRadius(radius * 0.5)
        .outerRadius(radius + 15);

      const color = d3.scaleOrdinal(d3.schemeSet3);

      const total = d3.sum(totalByPlatform, d => d.totalVentes);

      // Arcs
      const arcs = g.selectAll("path")
        .data(pie(totalByPlatform))
        .enter()
        .append("path")
        .attr("d", arc)
        .attr("fill", (d, i) => color(i))
        .attr("stroke", "#fff")
        .attr("stroke-width", 2.5)
        .style("cursor", "pointer")
        .on("mouseover", function (event, d) {
          d3.select(this)
            .transition()
            .duration(200)
            .attr("d", arcHover);

          const percent = (d.data.totalVentes / total * 100).toFixed(1);

          tooltip
            .style("opacity", 1)
            .html(`
              <div style="font-weight: bold; color: #00d2ff; margin-bottom: 5px; font-size: 14px;">
                ${d.data.platform}
              </div>
              <div style="font-weight: 600; margin-bottom: 3px;">
                Ventes: ${d.data.totalVentes.toFixed(2)}M
              </div>
              <div style="color: #7a8ba3;">
                Part: ${percent}%
              </div>
            `);
        })
        .on("mousemove", function (event) {
          tooltip
            .style("left", (event.pageX + 15) + "px")
            .style("top", (event.pageY - 30) + "px");
        })
        .on("mouseout", function () {
          d3.select(this)
            .transition()
            .duration(200)
            .attr("d", arc);

          tooltip.style("opacity", 0);
        });

      // L√©gende compl√®te avec toutes les plateformes
      const legend = svg.append("g")
        .attr("transform", `translate(${width - 220}, 20)`);

      legend.append("text")
        .attr("x", 0)
        .attr("y", 0)
        .text("Plateformes")
        .style("font-size", "16px")
        .style("font-weight", "bold")
        .style("fill", "#00d2ff")
        .style("text-decoration", "underline");

      totalByPlatform.forEach((d, i) => {
        const item = legend.append("g")
          .attr("transform", `translate(0, ${i * 22 + 20})`);

        item.append("circle")
          .attr("cx", 8)
          .attr("cy", 8)
          .attr("r", 6)
          .attr("fill", color(i))
          .attr("stroke", "#fff")
          .attr("stroke-width", 1);

        item.append("text")
          .attr("x", 20)
          .attr("y", 12)
          .text(`${d.platform} (${d.totalVentes.toFixed(0)}M)`)
          .style("font-size", "11px")
          .style("fill", "#fff");
      });

      // Centre
      g.append("text")
        .attr("text-anchor", "middle")
        .attr("dy", "-0.3em")
        .style("font-size", "18px")
        .style("font-weight", "bold")
        .style("fill", "#00d2ff")
        .text("Parts de");

      g.append("text")
        .attr("text-anchor", "middle")
        .attr("dy", "1.2em")
        .style("font-size", "18px")
        .style("font-weight", "bold")
        .style("fill", "#00d2ff")
        .text("March√©");

      console.log("‚úÖ Pie Chart OK avec", totalByPlatform.length, "plateformes");
    }

    // ==================== SUNBURST ====================
    function drawSunburst(data) {
      console.log("‚òÄÔ∏è Dessin Sunburst...");
      const svg = d3.select("#sunburst-svg");
      const width = +svg.attr("width");
      const height = +svg.attr("height");
      svg.selectAll("*").remove();

      const radius = Math.min(width, height) / 2 - 50;
      const g = svg.append("g")
        .attr("transform", `translate(${width / 2}, ${height / 2})`);

      const color = d3.scaleOrdinal(d3.schemePaired);

      const partition = d3.partition()
        .size([2 * Math.PI, radius]);

      const root = d3.hierarchy(data)
        .sum(d => d.value || 0)
        .sort((a, b) => b.value - a.value);

      partition(root);

      const arc = d3.arc()
        .startAngle(d => d.x0)
        .endAngle(d => d.x1)
        .innerRadius(d => d.y0)
        .outerRadius(d => d.y1);

      const arcHover = d3.arc()
        .startAngle(d => d.x0)
        .endAngle(d => d.x1)
        .innerRadius(d => d.y0)
        .outerRadius(d => d.y1 + 10);

      const segments = g.selectAll("path")
        .data(root.descendants().filter(d => d.depth > 0))
        .enter()
        .append("path")
        .attr("d", arc)
        .attr("fill", d => {
          while (d.depth > 1) d = d.parent;
          return color(d.data.name);
        })
        .attr("stroke", "#0a0e27")
        .attr("stroke-width", 2)
        .attr("opacity", 0.85)
        .style("cursor", "pointer")
        .on("mouseover", function (event, d) {
          d3.select(this)
            .transition()
            .duration(200)
            .attr("d", arcHover)
            .attr("opacity", 1);

          let path = [];
          let current = d;
          while (current && current.depth > 0) {
            path.unshift(current.data.name);
            current = current.parent;
          }

          const percentage = ((d.value / root.value) * 100).toFixed(1);

          tooltip
            .style("opacity", 1)
            .html(`
              <div style="font-weight: bold; color: #00d2ff; margin-bottom: 5px; font-size: 13px;">
                ${path.join(" ‚Üí ")}
              </div>
              <div style="font-weight: 600; margin-bottom: 3px;">
                Valeur: ${d.value.toFixed(2)}M
              </div>
              <div style="color: #7a8ba3; margin-bottom: 2px;">
                Part: ${percentage}%
              </div>
              <div style="color: #7a8ba3;">
                Niveau: ${d.depth}
              </div>
            `);
        })
        .on("mousemove", function (event) {
          tooltip
            .style("left", (event.pageX + 15) + "px")
            .style("top", (event.pageY - 30) + "px");
        })
        .on("mouseout", function () {
          d3.select(this)
            .transition()
            .duration(200)
            .attr("d", arc)
            .attr("opacity", 0.85);

          tooltip.style("opacity", 0);
        });

      // Centre
      g.append("text")
        .attr("text-anchor", "middle")
        .attr("dy", "-0.2em")
        .style("font-size", "22px")
        .style("font-weight", "bold")
        .style("fill", "#00d2ff")
        .text("Gaming");

      g.append("text")
        .attr("text-anchor", "middle")
        .attr("dy", "1.3em")
        .style("font-size", "17px")
        .style("fill", "#7a8ba3")
        .text("Analytics");

      console.log("‚úÖ Sunburst OK -", root.descendants().length, "segments");
    }
  </script>

</body>

</html>
